<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMKit 演示 - 国密算法在线测试</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            color: rgba(255,255,255,0.9);
            text-align: center;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }
        
        .tab:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .result h3 {
            margin-bottom: 10px;
            color: #667eea;
        }
        
        .result pre {
            background: white;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .info-box {
            background: #e8f4fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .info-box h4 {
            color: #2196F3;
            margin-bottom: 8px;
        }
        
        .info-box p {
            color: #555;
            line-height: 1.6;
        }
        
        .code-snippet {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .code-snippet code {
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔐 SMKit 演示</h1>
        <p class="subtitle">中国国密算法（SM2、SM3、SM4）在线测试工具</p>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('sm3')">SM3 哈希</button>
            <button class="tab" onclick="showTab('sm4')">SM4 加解密</button>
            <button class="tab" onclick="showTab('sm2')">SM2 签名验签</button>
            <button class="tab" onclick="showTab('tools')">调试工具</button>
            <button class="tab" onclick="showTab('about')">关于</button>
        </div>
        
        <!-- SM3 Tab -->
        <div id="sm3" class="tab-content active">
            <div class="info-box">
                <h4>SM3 密码哈希算法</h4>
                <p>SM3 是中国国家密码管理局发布的密码哈希算法，输出 256 位（32 字节）哈希值。</p>
            </div>
            
            <div class="form-group">
                <label for="sm3-input">输入文本：</label>
                <textarea id="sm3-input" placeholder="输入要计算哈希的文本...">Hello, SM3!</textarea>
            </div>
            
            <button onclick="testSM3()">计算 SM3 哈希</button>
            
            <div id="sm3-result"></div>
        </div>
        
        <!-- SM4 Tab -->
        <div id="sm4" class="tab-content">
            <div class="info-box">
                <h4>SM4 分组密码算法</h4>
                <p>SM4 是中国国家密码管理局发布的分组密码算法，密钥长度 128 位。支持 ECB 和 CBC 模式。</p>
            </div>
            
            <div class="form-group">
                <label for="sm4-key">密钥（32 位十六进制字符）：</label>
                <input type="text" id="sm4-key" value="0123456789abcdeffedcba9876543210" placeholder="请输入 16 字节的密钥（32 位十六进制）">
            </div>
            
            <div class="form-group">
                <label for="sm4-plaintext">明文：</label>
                <textarea id="sm4-plaintext" placeholder="输入要加密的文本...">Hello, SM4!</textarea>
            </div>
            
            <div class="button-group">
                <button onclick="testSM4Encrypt()">加密</button>
                <button onclick="testSM4Decrypt()">解密</button>
            </div>
            
            <div id="sm4-result"></div>
        </div>
        
        <!-- SM2 Tab -->
        <div id="sm2" class="tab-content">
            <div class="info-box">
                <h4>SM2 椭圆曲线公钥密码算法</h4>
                <p>SM2 是中国国家密码管理局发布的椭圆曲线公钥密码算法，基于 256 位椭圆曲线。</p>
            </div>
            
            <div class="button-group">
                <button onclick="generateSM2KeyPair(false)">生成密钥对（非压缩）</button>
                <button onclick="generateSM2KeyPair(true)">生成密钥对（压缩）</button>
            </div>
            
            <div class="form-group">
                <label for="sm2-private-key">私钥：</label>
                <input type="text" id="sm2-private-key" placeholder="点击"生成密钥对"按钮生成" readonly>
            </div>
            
            <div class="form-group">
                <label for="sm2-public-key">公钥：</label>
                <input type="text" id="sm2-public-key" placeholder="点击"生成密钥对"按钮生成" readonly>
            </div>
            
            <div class="form-group">
                <label for="sm2-message">消息：</label>
                <textarea id="sm2-message" placeholder="输入要签名的消息...">Hello, SM2!</textarea>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="sm2-skip-z" style="width: auto; margin-right: 5px;">
                    跳过 Z 值计算（用于测试，不推荐在生产环境使用）
                </label>
            </div>
            <div class="button-group">
                <button onclick="testSM2Sign()">签名</button>
                <button onclick="testSM2Verify()">验证签名</button>
            </div>
            
            <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e0e0e0;">
                <h3 style="margin-bottom: 15px;">SM2 加解密</h3>
                
                <div class="form-group">
                    <label for="sm2-encrypt-text">明文：</label>
                    <textarea id="sm2-encrypt-text" placeholder="输入要加密的文本...">Hello, SM2 Encryption!</textarea>
                </div>
                
                <div class="button-group">
                    <button onclick="testSM2Encrypt()">加密</button>
                    <button onclick="testSM2Decrypt()">解密</button>
                </div>
                
                <div id="sm2-encrypt-result"></div>
            </div>
            
            <div id="sm2-result"></div>
        </div>
        
        <!-- Tools Tab -->
        <div id="tools" class="tab-content">
            <div class="info-box">
                <h4>调试工具</h4>
                <p>提供各种实用工具用于调试和转换。</p>
            </div>
            
            <!-- 私钥生成公钥 -->
            <h3 style="margin-bottom: 15px;">私钥生成公钥</h3>
            <div class="form-group">
                <label for="tool-private-key">私钥（十六进制）：</label>
                <input type="text" id="tool-private-key" placeholder="输入私钥...">
            </div>
            <div class="button-group">
                <button onclick="derivePublicKey(false)">生成非压缩公钥</button>
                <button onclick="derivePublicKey(true)">生成压缩公钥</button>
            </div>
            <div id="derive-result"></div>
            
            <!-- 公钥格式转换 -->
            <h3 style="margin-top: 30px; margin-bottom: 15px;">公钥格式转换</h3>
            <div class="form-group">
                <label for="tool-public-key">公钥（十六进制）：</label>
                <input type="text" id="tool-public-key" placeholder="输入公钥...">
            </div>
            <div class="button-group">
                <button onclick="convertPublicKey('compress')">压缩公钥</button>
                <button onclick="convertPublicKey('decompress')">解压公钥</button>
            </div>
            <div id="convert-result"></div>
            
            <!-- ASN.1 签名转换 -->
            <h3 style="margin-top: 30px; margin-bottom: 15px;">签名格式转换</h3>
            <div class="form-group">
                <label for="tool-signature">签名（十六进制）：</label>
                <input type="text" id="tool-signature" placeholder="输入签名...">
            </div>
            <div class="button-group">
                <button onclick="convertSignature('raw-to-der')">Raw → DER</button>
                <button onclick="convertSignature('der-to-raw')">DER → Raw</button>
                <button onclick="convertSignature('to-xml')">转换为 XML</button>
            </div>
            <div id="signature-result"></div>
            
            <!-- 随机数生成测试 -->
            <h3 style="margin-top: 30px; margin-bottom: 15px;">随机数生成测试</h3>
            <div class="button-group">
                <button onclick="testRandomGenerator()">测试随机数生成器</button>
            </div>
            <div id="random-result"></div>
        </div>
        
        <!-- About Tab -->
        <div id="about" class="tab-content">
            <h2>关于 SMKit</h2>
            <p style="line-height: 1.8; margin: 20px 0;">
                SMKit 是一个纯 TypeScript 实现的中国国密算法库，包含 SM2、SM3、SM4 算法的完整实现。
            </p>
            
            <h3 style="margin-top: 30px; margin-bottom: 15px;">✨ 特性</h3>
            <ul style="line-height: 2; margin-left: 20px;">
                <li><strong>纯粹性</strong>：零运行时依赖，纯 TypeScript 实现</li>
                <li><strong>现代化</strong>：完整的 TypeScript 类型支持</li>
                <li><strong>同构性</strong>：同时支持 Node.js 和浏览器环境</li>
                <li><strong>高性能</strong>：优化的实现，基于 @noble/curves 准备</li>
            </ul>
            
            <h3 style="margin-top: 30px; margin-bottom: 15px;">📦 安装</h3>
            <div class="code-snippet">
                <code>npm install smkit</code>
            </div>
            
            <h3 style="margin-top: 30px; margin-bottom: 15px;">💻 使用示例</h3>
            <div class="code-snippet">
                <code>import { digest, sm4Encrypt, generateKeyPair } from 'smkit';

// SM3 哈希
const hash = digest('Hello, World!');

// SM4 加密
const encrypted = sm4Encrypt(key, plaintext);

// SM2 密钥生成
const keyPair = generateKeyPair();</code>
            </div>
            
            <h3 style="margin-top: 30px; margin-bottom: 15px;">🔗 链接</h3>
            <ul style="line-height: 2; margin-left: 20px;">
                <li><a href="https://github.com/linyuliu/smkit" target="_blank" style="color: #667eea;">GitHub 仓库</a></li>
                <li><a href="https://www.npmjs.com/package/smkit" target="_blank" style="color: #667eea;">NPM 包</a></li>
            </ul>
        </div>
    </div>
    
    <script type="module">
        // 导入 SMKit 库（使用本地构建的版本）
        import * as smkit from '../dist/smkit.js';
        
        // 将 smkit 暴露到全局 window 对象，方便 inline script 使用
        window.smkit = smkit;
        
        // 为了方便使用，创建包装函数
        window.smkitHelpers = {
            digest: (text) => smkit.digest(text),
            sm4Encrypt: (key, plaintext) => smkit.sm4Encrypt(key, plaintext, { 
                mode: smkit.CipherMode.ECB, 
                padding: smkit.PaddingMode.PKCS7 
            }),
            sm4Decrypt: (key, ciphertext) => smkit.sm4Decrypt(key, ciphertext, { 
                mode: smkit.CipherMode.ECB, 
                padding: smkit.PaddingMode.PKCS7 
            }),
            generateKeyPair: (compressed) => smkit.generateKeyPair(compressed),
            getPublicKeyFromPrivateKey: (privateKey, compressed) => smkit.getPublicKeyFromPrivateKey(privateKey, compressed),
            compressPublicKey: (publicKey) => smkit.compressPublicKey(publicKey),
            decompressPublicKey: (publicKey) => smkit.decompressPublicKey(publicKey),
            sign: (privateKey, message, options) => smkit.sign(privateKey, message, options),
            verify: (publicKey, message, signature, options) => smkit.verify(publicKey, message, signature, options),
            sm2Encrypt: (publicKey, plaintext) => smkit.sm2Encrypt(publicKey, plaintext),
            sm2Decrypt: (privateKey, ciphertext) => smkit.sm2Decrypt(privateKey, ciphertext),
            rawToDer: (raw) => smkit.rawToDer(raw),
            derToRaw: (der) => smkit.derToRaw(der),
            signatureToXml: (signature, isDer) => smkit.signatureToXml(signature, isDer),
            bytesToHex: (bytes) => smkit.bytesToHex(bytes)
        };
    </script>
    
    <script>
        function showTab(tabName) {
            // 隐藏所有标签页
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 显示选中的标签页
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        function testSM3() {
            try {
                const input = document.getElementById('sm3-input').value;
                const hash = window.smkitHelpers.digest(input);
                
                document.getElementById('sm3-result').innerHTML = `
                    <div class="result">
                        <h3>哈希结果：</h3>
                        <pre>${hash}</pre>
                        <p style="margin-top: 10px; color: #666;">输入长度: ${input.length} 字符</p>
                        <p style="color: #666;">哈希长度: ${hash.length} 字符 (256位)</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm3-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">错误：</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function testSM4Encrypt() {
            try {
                const key = document.getElementById('sm4-key').value;
                const plaintext = document.getElementById('sm4-plaintext').value;
                
                if (key.length !== 32) {
                    alert('密钥必须是 32 位十六进制字符（16 字节）');
                    return;
                }
                
                const ciphertext = window.smkitHelpers.sm4Encrypt(key, plaintext);
                
                document.getElementById('sm4-result').innerHTML = `
                    <div class="result">
                        <h3>加密结果：</h3>
                        <pre>${ciphertext}</pre>
                        <p style="margin-top: 10px; color: #666;">明文长度: ${plaintext.length} 字符</p>
                        <p style="color: #666;">密文长度: ${ciphertext.length} 字符 (十六进制)</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm4-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">错误：</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function testSM4Decrypt() {
            try {
                const key = document.getElementById('sm4-key').value;
                const resultDiv = document.getElementById('sm4-result');
                
                if (!resultDiv.textContent.includes('加密结果')) {
                    alert('请先加密');
                    return;
                }
                
                const ciphertext = resultDiv.querySelector('pre').textContent.trim();
                const plaintext = window.smkitHelpers.sm4Decrypt(key, ciphertext);
                
                document.getElementById('sm4-result').innerHTML = `
                    <div class="result">
                        <h3>解密结果：</h3>
                        <pre>${plaintext}</pre>
                        <p style="margin-top: 10px; color: #4CAF50;">✓ 解密成功</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm4-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">错误：</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function generateSM2KeyPair(compressed) {
            try {
                const keyPair = window.smkitHelpers.generateKeyPair(compressed);
                
                document.getElementById('sm2-private-key').value = keyPair.privateKey;
                document.getElementById('sm2-public-key').value = keyPair.publicKey;
                
                const format = compressed ? '压缩格式' : '非压缩格式';
                const prefix = keyPair.publicKey.substring(0, 2);
                
                document.getElementById('sm2-result').innerHTML = `
                    <div class="result">
                        <h3>密钥对已生成！</h3>
                        <p>私钥长度: ${keyPair.privateKey.length} 字符 (${keyPair.privateKey.length / 2} 字节)</p>
                        <p>公钥长度: ${keyPair.publicKey.length} 字符 (${keyPair.publicKey.length / 2} 字节)</p>
                        <p>公钥格式: ${format} (前缀: ${prefix})</p>
                        <p style="margin-top: 10px; color: #4CAF50;">✓ 基于 SM2 椭圆曲线算法</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm2-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">错误：</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        let currentSignature = '';
        let currentCiphertext = '';
        
        function testSM2Encrypt() {
            try {
                const publicKey = document.getElementById('sm2-public-key').value;
                const plaintext = document.getElementById('sm2-encrypt-text').value;
                
                if (!publicKey) {
                    alert('请先生成密钥对');
                    return;
                }
                
                currentCiphertext = window.smkitHelpers.sm2Encrypt(publicKey, plaintext);
                
                document.getElementById('sm2-encrypt-result').innerHTML = `
                    <div class="result">
                        <h3>加密结果：</h3>
                        <pre style="word-break: break-all;">${currentCiphertext}</pre>
                        <p style="margin-top: 10px; color: #666;">明文长度: ${plaintext.length} 字符</p>
                        <p style="color: #666;">密文长度: ${currentCiphertext.length} 字符 (${currentCiphertext.length / 2} 字节)</p>
                        <p style="color: #4CAF50;">✓ 使用公钥加密</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm2-encrypt-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">错误：</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function testSM2Decrypt() {
            try {
                const privateKey = document.getElementById('sm2-private-key').value;
                
                if (!privateKey) {
                    alert('请先生成密钥对');
                    return;
                }
                
                if (!currentCiphertext) {
                    alert('请先加密');
                    return;
                }
                
                const plaintext = window.smkitHelpers.sm2Decrypt(privateKey, currentCiphertext);
                
                document.getElementById('sm2-encrypt-result').innerHTML = `
                    <div class="result">
                        <h3>解密结果：</h3>
                        <pre>${plaintext}</pre>
                        <p style="margin-top: 10px; color: #4CAF50;">✓ 使用私钥解密成功</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm2-encrypt-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">错误：</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function testSM2Sign() {
            try {
                const privateKey = document.getElementById('sm2-private-key').value;
                const message = document.getElementById('sm2-message').value;
                const skipZ = document.getElementById('sm2-skip-z').checked;
                
                if (!privateKey) {
                    alert('请先生成密钥对');
                    return;
                }
                
                const options = skipZ ? { skipZComputation: true } : undefined;
                currentSignature = window.smkitHelpers.sign(privateKey, message, options);
                
                document.getElementById('sm2-result').innerHTML = `
                    <div class="result">
                        <h3>签名结果：</h3>
                        <pre>${currentSignature}</pre>
                        <p style="margin-top: 10px; color: #666;">签名长度: ${currentSignature.length} 字符 (${currentSignature.length / 2} 字节)</p>
                        <p style="color: #666;">使用 SM3 哈希算法${skipZ ? '（跳过 Z 值计算）' : ''}</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm2-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">错误：</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function testSM2Verify() {
            try {
                const publicKey = document.getElementById('sm2-public-key').value;
                const message = document.getElementById('sm2-message').value;
                const skipZ = document.getElementById('sm2-skip-z').checked;
                
                if (!publicKey) {
                    alert('请先生成密钥对');
                    return;
                }
                
                if (!currentSignature) {
                    alert('请先签名');
                    return;
                }
                
                const options = skipZ ? { skipZComputation: true } : undefined;
                const isValid = window.smkitHelpers.verify(publicKey, message, currentSignature, options);
                
                const statusColor = isValid ? '#4CAF50' : '#f44336';
                const statusIcon = isValid ? '✅' : '❌';
                
                document.getElementById('sm2-result').innerHTML = `
                    <div class="result" style="border-left-color: ${statusColor};">
                        <h3 style="color: ${statusColor};">验证结果：</h3>
                        <pre style="font-size: 18px; font-weight: bold;">签名${statusIcon} ${isValid ? '有效' : '无效'}</pre>
                        <p style="margin-top: 10px; color: #666;">使用公钥验证数字签名${skipZ ? '（跳过 Z 值计算）' : ''}</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm2-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">错误：</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        // 工具函数
        function derivePublicKey(compressed) {
            try {
                const privateKey = document.getElementById('tool-private-key').value.trim();
                
                if (!privateKey) {
                    alert('请输入私钥');
                    return;
                }
                
                const publicKey = window.smkitHelpers.getPublicKeyFromPrivateKey(privateKey, compressed);
                const format = compressed ? '压缩格式' : '非压缩格式';
                const prefix = publicKey.substring(0, 2);
                
                document.getElementById('derive-result').innerHTML = `
                    <div class="result">
                        <h3>生成的公钥（${format}）：</h3>
                        <pre style="word-break: break-all;">${publicKey}</pre>
                        <p style="margin-top: 10px; color: #666;">前缀: ${prefix}</p>
                        <p style="color: #666;">长度: ${publicKey.length} 字符 (${publicKey.length / 2} 字节)</p>
                        <p style="color: #4CAF50;">✓ 成功从私钥导出公钥</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('derive-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">错误：</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function convertPublicKey(type) {
            try {
                const publicKey = document.getElementById('tool-public-key').value.trim();
                
                if (!publicKey) {
                    alert('请输入公钥');
                    return;
                }
                
                let result, format;
                
                if (type === 'compress') {
                    result = window.smkitHelpers.compressPublicKey(publicKey);
                    format = '压缩格式';
                } else {
                    result = window.smkitHelpers.decompressPublicKey(publicKey);
                    format = '非压缩格式';
                }
                
                const prefix = result.substring(0, 2);
                
                document.getElementById('convert-result').innerHTML = `
                    <div class="result">
                        <h3>转换结果（${format}）：</h3>
                        <pre style="word-break: break-all;">${result}</pre>
                        <p style="margin-top: 10px; color: #666;">前缀: ${prefix}</p>
                        <p style="color: #666;">长度: ${result.length} 字符 (${result.length / 2} 字节)</p>
                        <p style="color: #4CAF50;">✓ 转换成功</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('convert-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">错误：</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function convertSignature(type) {
            try {
                const signature = document.getElementById('tool-signature').value.trim();
                
                if (!signature) {
                    alert('请输入签名');
                    return;
                }
                
                let resultHtml;
                
                if (type === 'raw-to-der') {
                    const der = window.smkitHelpers.rawToDer(signature);
                    const derHex = window.smkitHelpers.bytesToHex(der);
                    resultHtml = `
                        <div class="result">
                            <h3>DER 编码签名：</h3>
                            <pre style="word-break: break-all;">${derHex}</pre>
                            <p style="margin-top: 10px; color: #666;">长度: ${derHex.length} 字符 (${derHex.length / 2} 字节)</p>
                            <p style="color: #4CAF50;">✓ Raw → DER 转换成功</p>
                        </div>
                    `;
                } else if (type === 'der-to-raw') {
                    // 将十六进制字符串转换为 Uint8Array
                    const derBytes = new Uint8Array(signature.length / 2);
                    for (let i = 0; i < derBytes.length; i++) {
                        derBytes[i] = parseInt(signature.substring(i * 2, i * 2 + 2), 16);
                    }
                    const raw = window.smkitHelpers.derToRaw(derBytes);
                    resultHtml = `
                        <div class="result">
                            <h3>Raw 格式签名：</h3>
                            <pre style="word-break: break-all;">${raw}</pre>
                            <p style="margin-top: 10px; color: #666;">长度: ${raw.length} 字符 (${raw.length / 2} 字节)</p>
                            <p style="color: #4CAF50;">✓ DER → Raw 转换成功</p>
                        </div>
                    `;
                } else if (type === 'to-xml') {
                    // 自动检测格式
                    const isDer = signature.startsWith('30');
                    const xml = window.smkitHelpers.signatureToXml(signature, isDer);
                    resultHtml = `
                        <div class="result">
                            <h3>XML 格式：</h3>
                            <pre style="white-space: pre-wrap; word-break: break-all;">${xml}</pre>
                            <p style="margin-top: 10px; color: #4CAF50;">✓ 转换为 XML 成功</p>
                        </div>
                    `;
                }
                
                document.getElementById('signature-result').innerHTML = resultHtml;
            } catch (error) {
                document.getElementById('signature-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">错误：</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function testRandomGenerator() {
            try {
                // 生成多个密钥对来测试随机数生成器
                const keyPairs = [];
                const startTime = Date.now();
                
                for (let i = 0; i < 5; i++) {
                    keyPairs.push(window.smkitHelpers.generateKeyPair());
                }
                
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                // 检查生成的密钥是否唯一
                const uniqueKeys = new Set(keyPairs.map(kp => kp.privateKey));
                const allUnique = uniqueKeys.size === keyPairs.length;
                
                let resultHtml = `
                    <div class="result">
                        <h3>随机数生成器测试结果：</h3>
                        <p style="margin-top: 10px;">✓ 生成了 ${keyPairs.length} 个密钥对</p>
                        <p>✓ 耗时: ${duration} ms (平均 ${(duration / keyPairs.length).toFixed(2)} ms/个)</p>
                        <p>✓ 唯一性: ${allUnique ? '通过' : '失败'}</p>
                        <p style="margin-top: 15px; font-weight: bold;">生成的密钥对：</p>
                `;
                
                keyPairs.forEach((kp, i) => {
                    resultHtml += `
                        <div style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 4px;">
                            <p style="font-weight: bold;">密钥对 ${i + 1}:</p>
                            <p style="font-size: 12px; word-break: break-all;">私钥: ${kp.privateKey}</p>
                            <p style="font-size: 12px; word-break: break-all;">公钥: ${kp.publicKey.substring(0, 66)}...</p>
                        </div>
                    `;
                });
                
                resultHtml += `
                        <p style="margin-top: 15px; color: #4CAF50;">✓ 随机数生成器工作正常</p>
                    </div>
                `;
                
                document.getElementById('random-result').innerHTML = resultHtml;
            } catch (error) {
                document.getElementById('random-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">错误：</h3>
                        <pre>${error.message}</pre>
                        <p style="margin-top: 10px; color: #f44336;">随机数生成器可能不可用</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
