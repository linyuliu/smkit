<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMKit æ¼”ç¤º - å›½å¯†ç®—æ³•åœ¨çº¿æµ‹è¯•</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            color: rgba(255,255,255,0.9);
            text-align: center;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }
        
        .tab:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .result h3 {
            margin-bottom: 10px;
            color: #667eea;
        }
        
        .result pre {
            background: white;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .info-box {
            background: #e8f4fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .info-box h4 {
            color: #2196F3;
            margin-bottom: 8px;
        }
        
        .info-box p {
            color: #555;
            line-height: 1.6;
        }
        
        .code-snippet {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .code-snippet code {
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” SMKit æ¼”ç¤º</h1>
        <p class="subtitle">ä¸­å›½å›½å¯†ç®—æ³•ï¼ˆSM2ã€SM3ã€SM4ï¼‰åœ¨çº¿æµ‹è¯•å·¥å…·</p>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('sm2')">SM2 åŠ å¯†éªŒç­¾</button>
            <button class="tab" onclick="showTab('sm3')">SM3 å“ˆå¸Œ</button>
            <button class="tab" onclick="showTab('sm4')">SM4 åŠ è§£å¯†</button>
            <button class="tab" onclick="showTab('tools')">è°ƒè¯•å·¥å…·</button>
            <button class="tab" onclick="showTab('about')">å…³äº</button>
        </div>
        
        <!-- SM2 Tab -->
        <div id="sm2" class="tab-content active">
            <div class="info-box">
                <h4>SM2 æ¤­åœ†æ›²çº¿å…¬é’¥å¯†ç ç®—æ³•</h4>
                <p>SM2 æ˜¯ä¸­å›½å›½å®¶å¯†ç ç®¡ç†å±€å‘å¸ƒçš„æ¤­åœ†æ›²çº¿å…¬é’¥å¯†ç ç®—æ³•ï¼ŒåŸºäº 256 ä½æ¤­åœ†æ›²çº¿ã€‚</p>
            </div>
            
            <div class="button-group">
                <button onclick="generateSM2KeyPair()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; padding: 14px 28px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); transition: all 0.3s ease;">ğŸ”‘ ç”Ÿæˆå¯†é’¥å¯¹</button>
            </div>
            
            <div class="form-group">
                <label for="sm2-private-key">ç§é’¥ï¼š</label>
                <input type="text" id="sm2-private-key" placeholder="ç‚¹å‡»"ç”Ÿæˆå¯†é’¥å¯¹"æŒ‰é’®ç”Ÿæˆ" readonly>
            </div>
            
            <div class="form-group">
                <label for="sm2-public-key">å…¬é’¥ï¼š</label>
                <input type="text" id="sm2-public-key" placeholder="ç‚¹å‡»"ç”Ÿæˆå¯†é’¥å¯¹"æŒ‰é’®ç”Ÿæˆ" readonly>
            </div>
            
            <div class="form-group">
                <label for="sm2-message">æ¶ˆæ¯ï¼š</label>
                <textarea id="sm2-message" placeholder="è¾“å…¥è¦ç­¾åçš„æ¶ˆæ¯...">Hello, SM2!</textarea>
            </div>
            
            <div class="form-group">
                <label for="sm2-user-id">ç”¨æˆ·ID (User ID)ï¼š</label>
                <input type="text" id="sm2-user-id" placeholder="é»˜è®¤å€¼: 1234567812345678" value="1234567812345678">
                <p style="color: #666; font-size: 12px; margin-top: 5px;">ğŸ’¡ ç”¨äºç­¾åå’ŒéªŒç­¾æ—¶çš„ Z å€¼è®¡ç®—ï¼Œå¿…é¡»ä¿æŒä¸€è‡´ï¼ˆGM/T 0009-2012 è§„èŒƒé»˜è®¤å€¼ï¼‰</p>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="sm2-skip-z" style="width: auto; margin-right: 5px;">
                    è·³è¿‡ Z å€¼è®¡ç®—ï¼ˆç”¨äºæµ‹è¯•ï¼Œä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼‰
                </label>
            </div>
            <div class="button-group">
                <button onclick="testSM2Sign()">ç­¾å</button>
                <button onclick="testSM2Verify()">éªŒè¯ç­¾å</button>
            </div>
            
            <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e0e0e0;">
                <h3 style="margin-bottom: 15px;">SM2 åŠ è§£å¯†</h3>
                
                <div class="form-group">
                    <label for="sm2-encrypt-text">æ˜æ–‡ï¼š</label>
                    <textarea id="sm2-encrypt-text" placeholder="è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬...">Hello, SM2 Encryption!</textarea>
                </div>
                
                <div class="button-group">
                    <button onclick="testSM2Encrypt()">åŠ å¯†</button>
                    <button onclick="testSM2Decrypt()">è§£å¯†</button>
                </div>
                
                <div id="sm2-encrypt-result"></div>
            </div>
            
            <div id="sm2-result"></div>
        </div>
        
        <!-- SM3 Tab -->
        <div id="sm3" class="tab-content">
            <div class="info-box">
                <h4>SM3 å¯†ç å“ˆå¸Œç®—æ³•</h4>
                <p>SM3 æ˜¯ä¸­å›½å›½å®¶å¯†ç ç®¡ç†å±€å‘å¸ƒçš„å¯†ç å“ˆå¸Œç®—æ³•ï¼Œè¾“å‡º 256 ä½ï¼ˆ32 å­—èŠ‚ï¼‰å“ˆå¸Œå€¼ã€‚</p>
            </div>
            
            <div class="form-group">
                <label for="sm3-input">è¾“å…¥æ–‡æœ¬ï¼š</label>
                <textarea id="sm3-input" placeholder="è¾“å…¥è¦è®¡ç®—å“ˆå¸Œçš„æ–‡æœ¬...">Hello, SM3!</textarea>
            </div>
            
            <button onclick="testSM3()">è®¡ç®— SM3 å“ˆå¸Œ</button>
            
            <div id="sm3-result"></div>
        </div>
        
        <!-- SM4 Tab -->
        <div id="sm4" class="tab-content">
            <div class="info-box">
                <h4>SM4 åˆ†ç»„å¯†ç ç®—æ³•</h4>
                <p>SM4 æ˜¯ä¸­å›½å›½å®¶å¯†ç ç®¡ç†å±€å‘å¸ƒçš„åˆ†ç»„å¯†ç ç®—æ³•ï¼Œå¯†é’¥é•¿åº¦ 128 ä½ã€‚æ”¯æŒå¤šç§åŠ å¯†æ¨¡å¼ã€‚</p>
            </div>
            
            <div class="form-group">
                <label for="sm4-key">å¯†é’¥ (128æ¯”ç‰¹)ï¼š</label>
                <input type="text" id="sm4-key" value="0123456789abcdeffedcba9876543210" placeholder="è¯·è¾“å…¥ 16 å­—èŠ‚çš„å¯†é’¥ï¼ˆ32 ä½åå…­è¿›åˆ¶ï¼‰">
            </div>
            
            <div class="form-group">
                <label for="sm4-key-format">å¯†é’¥æ•°æ®æ ¼å¼ï¼š</label>
                <select id="sm4-key-format">
                    <option value="hex" selected>åå…­è¿›åˆ¶ (Hex)</option>
                    <option value="text">æ–‡æœ¬ (Text)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="sm4-iv">IV (CBC/CFB/OFB åŠ å¯†æ¨¡å¼ä¸‹å¯ç”¨)ï¼š</label>
                <input type="text" id="sm4-iv" value="fedcba98765432100123456789abcdef" placeholder="è¯·è¾“å…¥ 16 å­—èŠ‚çš„ IVï¼ˆ32 ä½åå…­è¿›åˆ¶ï¼‰">
            </div>
            
            <div class="form-group">
                <label for="sm4-iv-format">IV æ•°æ®æ ¼å¼ï¼š</label>
                <select id="sm4-iv-format">
                    <option value="hex" selected>åå…­è¿›åˆ¶ (Hex)</option>
                    <option value="text">æ–‡æœ¬ (Text)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="sm4-mode">åŠ å¯†æ¨¡å¼ï¼š</label>
                <select id="sm4-mode">
                    <option value="ecb" selected>ECB (ç”µç æœ¬æ¨¡å¼)</option>
                    <option value="cbc">CBC (å¯†ç åˆ†ç»„é“¾æ¥æ¨¡å¼)</option>
                    <option value="ctr">CTR (è®¡æ•°å™¨æ¨¡å¼)</option>
                    <option value="cfb">CFB (å¯†ç åé¦ˆæ¨¡å¼)</option>
                    <option value="ofb">OFB (è¾“å‡ºåé¦ˆæ¨¡å¼)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="sm4-padding">å¡«å……æ¨¡å¼ï¼š</label>
                <select id="sm4-padding">
                    <option value="pkcs7" selected>PKCS7</option>
                    <option value="none">None</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="sm4-result-format">åŠ å¯†ç»“æœæ•°æ®æ ¼å¼ï¼š</label>
                <select id="sm4-result-format">
                    <option value="hex" selected>åå…­è¿›åˆ¶ (Hex)</option>
                    <option value="base64">Base64</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="sm4-plaintext">æ˜æ–‡ï¼š</label>
                <textarea id="sm4-plaintext" placeholder="è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬...">Hello, SM4!</textarea>
            </div>
            
            <div class="button-group">
                <button onclick="testSM4Encrypt()">åŠ å¯†</button>
                <button onclick="testSM4Decrypt()">è§£å¯†</button>
            </div>
            
            <div id="sm4-result"></div>
        </div>
        
        <!-- Tools Tab -->
        <div id="tools" class="tab-content">
            <div class="info-box">
                <h4>è°ƒè¯•å·¥å…·</h4>
                <p>æä¾›å„ç§å®ç”¨å·¥å…·ç”¨äºè°ƒè¯•å’Œè½¬æ¢ã€‚</p>
            </div>
            
            <!-- ç§é’¥ç”Ÿæˆå…¬é’¥ -->
            <h3 style="margin-bottom: 15px;">ç§é’¥ç”Ÿæˆå…¬é’¥</h3>
            <div class="form-group">
                <label for="tool-private-key">ç§é’¥ï¼ˆåå…­è¿›åˆ¶ï¼‰ï¼š</label>
                <input type="text" id="tool-private-key" placeholder="è¾“å…¥ç§é’¥...">
            </div>
            <div class="button-group">
                <button onclick="derivePublicKey(false)">ç”Ÿæˆéå‹ç¼©å…¬é’¥</button>
                <button onclick="derivePublicKey(true)">ç”Ÿæˆå‹ç¼©å…¬é’¥</button>
            </div>
            <div id="derive-result"></div>
            
            <!-- å…¬é’¥æ ¼å¼è½¬æ¢ -->
            <h3 style="margin-top: 30px; margin-bottom: 15px;">å…¬é’¥æ ¼å¼è½¬æ¢</h3>
            <div class="form-group">
                <label for="tool-public-key">å…¬é’¥ï¼ˆåå…­è¿›åˆ¶ï¼‰ï¼š</label>
                <input type="text" id="tool-public-key" placeholder="è¾“å…¥å…¬é’¥...">
            </div>
            <div class="button-group">
                <button onclick="convertPublicKey('compress')">å‹ç¼©å…¬é’¥</button>
                <button onclick="convertPublicKey('decompress')">è§£å‹å…¬é’¥</button>
            </div>
            <div id="convert-result"></div>
            
            <!-- ASN.1 ç­¾åè½¬æ¢ -->
            <h3 style="margin-top: 30px; margin-bottom: 15px;">ç­¾åæ ¼å¼è½¬æ¢</h3>
            <div class="form-group">
                <label for="tool-signature">ç­¾åï¼ˆåå…­è¿›åˆ¶ï¼‰ï¼š</label>
                <input type="text" id="tool-signature" placeholder="è¾“å…¥ç­¾å...">
            </div>
            <div class="button-group">
                <button onclick="convertSignature('raw-to-der')">Raw â†’ DER</button>
                <button onclick="convertSignature('der-to-raw')">DER â†’ Raw</button>
                <button onclick="convertSignature('to-xml')">è½¬æ¢ä¸º XML</button>
            </div>
            <div id="signature-result"></div>
            
            <!-- éšæœºæ•°ç”Ÿæˆæµ‹è¯• -->
            <h3 style="margin-top: 30px; margin-bottom: 15px;">éšæœºæ•°ç”Ÿæˆæµ‹è¯•</h3>
            <div class="button-group">
                <button onclick="testRandomGenerator()">æµ‹è¯•éšæœºæ•°ç”Ÿæˆå™¨</button>
            </div>
            <div id="random-result"></div>
        </div>
        
        <!-- About Tab -->
        <div id="about" class="tab-content">
            <h2>å…³äº SMKit</h2>
            <p style="line-height: 1.8; margin: 20px 0;">
                SMKit æ˜¯ä¸€ä¸ªçº¯ TypeScript å®ç°çš„ä¸­å›½å›½å¯†ç®—æ³•åº“ï¼ŒåŒ…å« SM2ã€SM3ã€SM4 ç®—æ³•çš„å®Œæ•´å®ç°ã€‚
            </p>
            
            <h3 style="margin-top: 30px; margin-bottom: 15px;">âœ¨ ç‰¹æ€§</h3>
            <ul style="line-height: 2; margin-left: 20px;">
                <li><strong>çº¯ç²¹æ€§</strong>ï¼šé›¶è¿è¡Œæ—¶ä¾èµ–ï¼Œçº¯ TypeScript å®ç°</li>
                <li><strong>ç°ä»£åŒ–</strong>ï¼šå®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ</li>
                <li><strong>åŒæ„æ€§</strong>ï¼šåŒæ—¶æ”¯æŒ Node.js å’Œæµè§ˆå™¨ç¯å¢ƒ</li>
                <li><strong>é«˜æ€§èƒ½</strong>ï¼šä¼˜åŒ–çš„å®ç°ï¼ŒåŸºäº @noble/curves å‡†å¤‡</li>
            </ul>
            
            <h3 style="margin-top: 30px; margin-bottom: 15px;">ğŸ“¦ å®‰è£…</h3>
            <div class="code-snippet">
                <code>npm install smkit</code>
            </div>
            
            <h3 style="margin-top: 30px; margin-bottom: 15px;">ğŸ’» ä½¿ç”¨ç¤ºä¾‹</h3>
            <div class="code-snippet">
                <code>import { digest, sm4Encrypt, generateKeyPair } from 'smkit';

// SM3 å“ˆå¸Œ
const hash = digest('Hello, World!');

// SM4 åŠ å¯†
const encrypted = sm4Encrypt(key, plaintext);

// SM2 å¯†é’¥ç”Ÿæˆ
const keyPair = generateKeyPair();</code>
            </div>
            
            <h3 style="margin-top: 30px; margin-bottom: 15px;">ğŸ”— é“¾æ¥</h3>
            <ul style="line-height: 2; margin-left: 20px;">
                <li><a href="https://github.com/linyuliu/smkit" target="_blank" style="color: #667eea;">GitHub ä»“åº“</a></li>
                <li><a href="https://www.npmjs.com/package/smkit" target="_blank" style="color: #667eea;">NPM åŒ…</a></li>
            </ul>
        </div>
    </div>
    
    <script type="module">
        // å¯¼å…¥ SMKit åº“ï¼ˆä½¿ç”¨æœ¬åœ°æ„å»ºçš„ç‰ˆæœ¬ï¼‰
        import * as smkit from '../dist/smkit.js';
        
        // å°† smkit æš´éœ²åˆ°å…¨å±€ window å¯¹è±¡ï¼Œæ–¹ä¾¿ inline script ä½¿ç”¨
        window.smkit = smkit;
        
        // ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œåˆ›å»ºåŒ…è£…å‡½æ•°
        window.smkitHelpers = {
            digest: (text) => smkit.digest(text),
            sm4Encrypt: (key, plaintext) => smkit.sm4Encrypt(key, plaintext, { 
                mode: smkit.CipherMode.ECB, 
                padding: smkit.PaddingMode.PKCS7 
            }),
            sm4Decrypt: (key, ciphertext) => smkit.sm4Decrypt(key, ciphertext, { 
                mode: smkit.CipherMode.ECB, 
                padding: smkit.PaddingMode.PKCS7 
            }),
            generateKeyPair: (compressed) => smkit.generateKeyPair(compressed),
            getPublicKeyFromPrivateKey: (privateKey, compressed) => smkit.getPublicKeyFromPrivateKey(privateKey, compressed),
            compressPublicKey: (publicKey) => smkit.compressPublicKey(publicKey),
            decompressPublicKey: (publicKey) => smkit.decompressPublicKey(publicKey),
            sign: (privateKey, message, options) => smkit.sign(privateKey, message, options),
            verify: (publicKey, message, signature, options) => smkit.verify(publicKey, message, signature, options),
            sm2Encrypt: (publicKey, plaintext) => smkit.sm2Encrypt(publicKey, plaintext),
            sm2Decrypt: (privateKey, ciphertext) => smkit.sm2Decrypt(privateKey, ciphertext),
            rawToDer: (raw) => smkit.rawToDer(raw),
            derToRaw: (der) => smkit.derToRaw(der),
            signatureToXml: (signature, isDer) => smkit.signatureToXml(signature, isDer),
            bytesToHex: (bytes) => smkit.bytesToHex(bytes)
        };
    </script>
    
    <script>
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        function testSM3() {
            try {
                const input = document.getElementById('sm3-input').value;
                const hash = window.smkitHelpers.digest(input);
                
                document.getElementById('sm3-result').innerHTML = `
                    <div class="result">
                        <h3>å“ˆå¸Œç»“æœï¼š</h3>
                        <pre>${hash}</pre>
                        <p style="margin-top: 10px; color: #666;">è¾“å…¥é•¿åº¦: ${input.length} å­—ç¬¦</p>
                        <p style="color: #666;">å“ˆå¸Œé•¿åº¦: ${hash.length} å­—ç¬¦ (256ä½)</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm3-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">é”™è¯¯ï¼š</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function testSM4Encrypt() {
            try {
                let key = document.getElementById('sm4-key').value;
                const keyFormat = document.getElementById('sm4-key-format').value;
                const plaintext = document.getElementById('sm4-plaintext').value;
                const mode = document.getElementById('sm4-mode').value;
                const padding = document.getElementById('sm4-padding').value;
                let iv = document.getElementById('sm4-iv').value;
                const ivFormat = document.getElementById('sm4-iv-format').value;
                const resultFormat = document.getElementById('sm4-result-format').value;
                
                // å¤„ç†å¯†é’¥æ ¼å¼
                if (keyFormat === 'text') {
                    key = window.smkitHelpers.bytesToHex(new TextEncoder().encode(key));
                }
                
                if (key.length !== 32) {
                    alert('å¯†é’¥å¿…é¡»æ˜¯ 32 ä½åå…­è¿›åˆ¶å­—ç¬¦ï¼ˆ16 å­—èŠ‚ï¼‰');
                    return;
                }
                
                // å¤„ç† IV æ ¼å¼
                if (ivFormat === 'text') {
                    iv = window.smkitHelpers.bytesToHex(new TextEncoder().encode(iv));
                }
                
                // æ„å»ºé€‰é¡¹
                const options = { 
                    mode: window.smkit.CipherMode[mode.toUpperCase()], 
                    padding: window.smkit.PaddingMode[padding.toUpperCase()]
                };
                
                if (mode !== 'ecb' && iv) {
                    if (iv.length !== 32) {
                        alert('IV å¿…é¡»æ˜¯ 32 ä½åå…­è¿›åˆ¶å­—ç¬¦ï¼ˆ16 å­—èŠ‚ï¼‰');
                        return;
                    }
                    options.iv = iv;
                }
                
                const ciphertext = window.smkit.sm4Encrypt(key, plaintext, options);
                
                // å¤„ç†è¾“å‡ºæ ¼å¼
                let displayResult = ciphertext;
                if (resultFormat === 'base64') {
                    // å°†åå…­è¿›åˆ¶è½¬æ¢ä¸º base64
                    const hexPairs = ciphertext.match(/.{2}/g);
                    if (!hexPairs) {
                        throw new Error('Invalid ciphertext format');
                    }
                    const bytes = new Uint8Array(hexPairs.map(byte => parseInt(byte, 16)));
                    // é¿å…ä½¿ç”¨ apply å¯¼è‡´æ ˆæº¢å‡ºï¼Œä½¿ç”¨åˆ†å—å¤„ç†
                    let binary = '';
                    for (let i = 0; i < bytes.length; i++) {
                        binary += String.fromCharCode(bytes[i]);
                    }
                    displayResult = btoa(binary);
                }
                
                document.getElementById('sm4-result').innerHTML = `
                    <div class="result">
                        <h3>åŠ å¯†ç»“æœï¼š</h3>
                        <pre style="word-break: break-all;">${displayResult}</pre>
                        <p style="margin-top: 10px; color: #666;">æ˜æ–‡é•¿åº¦: ${plaintext.length} å­—ç¬¦</p>
                        <p style="color: #666;">åŠ å¯†æ¨¡å¼: ${mode.toUpperCase()}</p>
                        <p style="color: #666;">å¡«å……æ¨¡å¼: ${padding.toUpperCase()}</p>
                        <p style="color: #666;">è¾“å‡ºæ ¼å¼: ${resultFormat === 'hex' ? 'åå…­è¿›åˆ¶' : 'Base64'}</p>
                        <p style="color: #666;">å¯†æ–‡é•¿åº¦: ${displayResult.length} å­—ç¬¦</p>
                    </div>
                `;
                
                // ä¿å­˜å¯†æ–‡ä»¥ä¾›è§£å¯†ä½¿ç”¨
                window.currentSM4Ciphertext = ciphertext;
                window.currentSM4Mode = mode;
                window.currentSM4Padding = padding;
                window.currentSM4IV = iv;
            } catch (error) {
                document.getElementById('sm4-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">é”™è¯¯ï¼š</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function testSM4Decrypt() {
            try {
                let key = document.getElementById('sm4-key').value;
                const keyFormat = document.getElementById('sm4-key-format').value;
                
                if (!window.currentSM4Ciphertext) {
                    alert('è¯·å…ˆåŠ å¯†');
                    return;
                }
                
                // å¤„ç†å¯†é’¥æ ¼å¼
                if (keyFormat === 'text') {
                    key = window.smkitHelpers.bytesToHex(new TextEncoder().encode(key));
                }
                
                if (key.length !== 32) {
                    alert('å¯†é’¥å¿…é¡»æ˜¯ 32 ä½åå…­è¿›åˆ¶å­—ç¬¦ï¼ˆ16 å­—èŠ‚ï¼‰');
                    return;
                }
                
                // æ„å»ºé€‰é¡¹
                const options = { 
                    mode: window.smkit.CipherMode[window.currentSM4Mode.toUpperCase()], 
                    padding: window.smkit.PaddingMode[window.currentSM4Padding.toUpperCase()]
                };
                
                if (window.currentSM4Mode !== 'ecb' && window.currentSM4IV) {
                    options.iv = window.currentSM4IV;
                }
                
                const plaintext = window.smkit.sm4Decrypt(key, window.currentSM4Ciphertext, options);
                
                document.getElementById('sm4-result').innerHTML = `
                    <div class="result">
                        <h3>è§£å¯†ç»“æœï¼š</h3>
                        <pre>${plaintext}</pre>
                        <p style="margin-top: 10px; color: #4CAF50;">âœ“ è§£å¯†æˆåŠŸ</p>
                        <p style="color: #666;">åŠ å¯†æ¨¡å¼: ${window.currentSM4Mode.toUpperCase()}</p>
                        <p style="color: #666;">å¡«å……æ¨¡å¼: ${window.currentSM4Padding.toUpperCase()}</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm4-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">é”™è¯¯ï¼š</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function generateSM2KeyPair() {
            try {
                // ç”Ÿæˆéå‹ç¼©æ ¼å¼çš„å¯†é’¥å¯¹
                const keyPair = window.smkitHelpers.generateKeyPair(false);
                
                // å¡«å……è¾“å…¥æ¡†ï¼ˆä½¿ç”¨éå‹ç¼©å…¬é’¥ï¼‰
                document.getElementById('sm2-private-key').value = keyPair.privateKey;
                document.getElementById('sm2-public-key').value = keyPair.publicKey;
                
                // ç”Ÿæˆå‹ç¼©æ ¼å¼çš„å…¬é’¥
                const compressedKey = window.smkitHelpers.compressPublicKey(keyPair.publicKey);
                const uncompressedKey = keyPair.publicKey;
                
                // æå–å…¬é’¥åæ ‡ X å’Œ Yï¼ˆå»æ‰04å‰ç¼€ï¼Œå‰64ä¸ªå­—ç¬¦æ˜¯Xï¼Œå64ä¸ªå­—ç¬¦æ˜¯Yï¼‰
                const publicKeyX = uncompressedKey.substring(2, 66);
                const publicKeyY = uncompressedKey.substring(66, 130);
                
                document.getElementById('sm2-result').innerHTML = `
                    <div class="result" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-left: 5px solid #667eea; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <h3 style="color: #667eea; font-size: 1.3em; margin-bottom: 15px;">âœ… å¯†é’¥å¯¹ç”ŸæˆæˆåŠŸ</h3>
                        
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <span style="font-size: 24px; margin-right: 10px;">ğŸ”</span>
                                <strong style="color: #333; font-size: 1.1em;">ç§é’¥ (Private Key)</strong>
                            </div>
                            <p style="color: #666; margin: 8px 0;">é•¿åº¦: <span style="color: #667eea; font-weight: 600;">${keyPair.privateKey.length}</span> å­—ç¬¦ (<span style="color: #667eea; font-weight: 600;">${keyPair.privateKey.length / 2}</span> å­—èŠ‚)</p>
                            <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin-top: 10px; border-left: 3px solid #667eea;">
                                <code style="word-break: break-all; font-size: 13px; color: #495057;">${keyPair.privateKey}</code>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <span style="font-size: 24px; margin-right: 10px;">ğŸ“</span>
                                <strong style="color: #333; font-size: 1.1em;">å…¬é’¥ X åæ ‡</strong>
                                <span style="background: #fff3e0; color: #e65100; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin-left: 10px; font-weight: 600;">X</span>
                            </div>
                            <p style="color: #666; margin: 8px 0;">é•¿åº¦: <span style="color: #e65100; font-weight: 600;">${publicKeyX.length}</span> å­—ç¬¦ (<span style="color: #e65100; font-weight: 600;">${publicKeyX.length / 2}</span> å­—èŠ‚)</p>
                            <div style="background: #fff3e0; padding: 10px; border-radius: 6px; margin-top: 10px; border-left: 3px solid #e65100;">
                                <code style="word-break: break-all; font-size: 13px; color: #bf360c;">${publicKeyX}</code>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <span style="font-size: 24px; margin-right: 10px;">ğŸ“</span>
                                <strong style="color: #333; font-size: 1.1em;">å…¬é’¥ Y åæ ‡</strong>
                                <span style="background: #f3e5f5; color: #6a1b9a; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin-left: 10px; font-weight: 600;">Y</span>
                            </div>
                            <p style="color: #666; margin: 8px 0;">é•¿åº¦: <span style="color: #6a1b9a; font-weight: 600;">${publicKeyY.length}</span> å­—ç¬¦ (<span style="color: #6a1b9a; font-weight: 600;">${publicKeyY.length / 2}</span> å­—èŠ‚)</p>
                            <div style="background: #f3e5f5; padding: 10px; border-radius: 6px; margin-top: 10px; border-left: 3px solid #6a1b9a;">
                                <code style="word-break: break-all; font-size: 13px; color: #4a148c;">${publicKeyY}</code>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <span style="font-size: 24px; margin-right: 10px;">ğŸ”‘</span>
                                <strong style="color: #333; font-size: 1.1em;">éå‹ç¼©å…¬é’¥ (Uncompressed Public Key)</strong>
                                <span style="background: #e3f2fd; color: #1976d2; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin-left: 10px; font-weight: 600;">04å‰ç¼€</span>
                            </div>
                            <p style="color: #666; margin: 8px 0;">é•¿åº¦: <span style="color: #1976d2; font-weight: 600;">${uncompressedKey.length}</span> å­—ç¬¦ (<span style="color: #1976d2; font-weight: 600;">${uncompressedKey.length / 2}</span> å­—èŠ‚)</p>
                            <div style="background: #e3f2fd; padding: 10px; border-radius: 6px; margin-top: 10px; border-left: 3px solid #1976d2;">
                                <code style="word-break: break-all; font-size: 13px; color: #1565c0;">${uncompressedKey}</code>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <span style="font-size: 24px; margin-right: 10px;">ğŸ—œï¸</span>
                                <strong style="color: #333; font-size: 1.1em;">å‹ç¼©å…¬é’¥ (Compressed Public Key)</strong>
                                <span style="background: #e8f5e9; color: #388e3c; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin-left: 10px; font-weight: 600;">02/03å‰ç¼€</span>
                            </div>
                            <p style="color: #666; margin: 8px 0;">é•¿åº¦: <span style="color: #388e3c; font-weight: 600;">${compressedKey.length}</span> å­—ç¬¦ (<span style="color: #388e3c; font-weight: 600;">${compressedKey.length / 2}</span> å­—èŠ‚)</p>
                            <div style="background: #e8f5e9; padding: 10px; border-radius: 6px; margin-top: 10px; border-left: 3px solid #388e3c;">
                                <code style="word-break: break-all; font-size: 13px; color: #2e7d32;">${compressedKey}</code>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 6px; border-left: 3px solid #667eea;">
                            <p style="color: #667eea; font-weight: 600; margin: 0;">
                                <span style="font-size: 18px; margin-right: 8px;">âœ¨</span>
                                å…¬é’¥æ ¼å¼è¯´æ˜ï¼šéå‹ç¼©æ ¼å¼ = 04 + X + Yï¼Œå‹ç¼©æ ¼å¼ = 02/03 + X
                            </p>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm2-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">âŒ é”™è¯¯</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        let currentSignature = '';
        let currentCiphertext = '';
        const DEFAULT_USER_ID = '1234567812345678';
        
        function testSM2Encrypt() {
            try {
                const publicKey = document.getElementById('sm2-public-key').value;
                const plaintext = document.getElementById('sm2-encrypt-text').value;
                
                if (!publicKey) {
                    alert('è¯·å…ˆç”Ÿæˆå¯†é’¥å¯¹');
                    return;
                }
                
                currentCiphertext = window.smkitHelpers.sm2Encrypt(publicKey, plaintext);
                
                document.getElementById('sm2-encrypt-result').innerHTML = `
                    <div class="result">
                        <h3>åŠ å¯†ç»“æœï¼š</h3>
                        <pre style="word-break: break-all;">${currentCiphertext}</pre>
                        <p style="margin-top: 10px; color: #666;">æ˜æ–‡é•¿åº¦: ${plaintext.length} å­—ç¬¦</p>
                        <p style="color: #666;">å¯†æ–‡é•¿åº¦: ${currentCiphertext.length} å­—ç¬¦ (${currentCiphertext.length / 2} å­—èŠ‚)</p>
                        <p style="color: #4CAF50;">âœ“ ä½¿ç”¨å…¬é’¥åŠ å¯†</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm2-encrypt-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">é”™è¯¯ï¼š</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function testSM2Decrypt() {
            try {
                const privateKey = document.getElementById('sm2-private-key').value;
                
                if (!privateKey) {
                    alert('è¯·å…ˆç”Ÿæˆå¯†é’¥å¯¹');
                    return;
                }
                
                if (!currentCiphertext) {
                    alert('è¯·å…ˆåŠ å¯†');
                    return;
                }
                
                const plaintext = window.smkitHelpers.sm2Decrypt(privateKey, currentCiphertext);
                
                document.getElementById('sm2-encrypt-result').innerHTML = `
                    <div class="result">
                        <h3>è§£å¯†ç»“æœï¼š</h3>
                        <pre>${plaintext}</pre>
                        <p style="margin-top: 10px; color: #4CAF50;">âœ“ ä½¿ç”¨ç§é’¥è§£å¯†æˆåŠŸ</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm2-encrypt-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">é”™è¯¯ï¼š</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function testSM2Sign() {
            try {
                const privateKey = document.getElementById('sm2-private-key').value;
                const message = document.getElementById('sm2-message').value;
                const userId = document.getElementById('sm2-user-id').value.trim() || DEFAULT_USER_ID;
                const skipZ = document.getElementById('sm2-skip-z').checked;
                
                if (!privateKey) {
                    alert('è¯·å…ˆç”Ÿæˆå¯†é’¥å¯¹');
                    return;
                }
                
                // æ„å»ºç­¾åé€‰é¡¹
                const options = {};
                if (skipZ) {
                    options.skipZComputation = true;
                } else {
                    options.userId = userId;
                }
                
                currentSignature = window.smkitHelpers.sign(privateKey, message, options);
                
                document.getElementById('sm2-result').innerHTML = `
                    <div class="result">
                        <h3>ç­¾åç»“æœï¼š</h3>
                        <pre>${currentSignature}</pre>
                        <p style="margin-top: 10px; color: #666;">ç­¾åé•¿åº¦: ${currentSignature.length} å­—ç¬¦ (${currentSignature.length / 2} å­—èŠ‚)</p>
                        <p style="color: #666;">ä½¿ç”¨ SM3 å“ˆå¸Œç®—æ³•${skipZ ? 'ï¼ˆè·³è¿‡ Z å€¼è®¡ç®—ï¼‰' : 'ï¼Œç”¨æˆ·ID: ' + userId}</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm2-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">é”™è¯¯ï¼š</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function testSM2Verify() {
            try {
                const publicKey = document.getElementById('sm2-public-key').value;
                const message = document.getElementById('sm2-message').value;
                const userId = document.getElementById('sm2-user-id').value.trim() || DEFAULT_USER_ID;
                const skipZ = document.getElementById('sm2-skip-z').checked;
                
                if (!publicKey) {
                    alert('è¯·å…ˆç”Ÿæˆå¯†é’¥å¯¹');
                    return;
                }
                
                if (!currentSignature) {
                    alert('è¯·å…ˆç­¾å');
                    return;
                }
                
                // æ„å»ºéªŒè¯é€‰é¡¹
                const options = {};
                if (skipZ) {
                    options.skipZComputation = true;
                } else {
                    options.userId = userId;
                }
                
                const isValid = window.smkitHelpers.verify(publicKey, message, currentSignature, options);
                
                const statusColor = isValid ? '#4CAF50' : '#f44336';
                const statusIcon = isValid ? 'âœ…' : 'âŒ';
                
                document.getElementById('sm2-result').innerHTML = `
                    <div class="result" style="border-left-color: ${statusColor};">
                        <h3 style="color: ${statusColor};">éªŒè¯ç»“æœï¼š</h3>
                        <pre style="font-size: 18px; font-weight: bold;">ç­¾å${statusIcon} ${isValid ? 'æœ‰æ•ˆ' : 'æ— æ•ˆ'}</pre>
                        <p style="margin-top: 10px; color: #666;">ä½¿ç”¨å…¬é’¥éªŒè¯æ•°å­—ç­¾å${skipZ ? 'ï¼ˆè·³è¿‡ Z å€¼è®¡ç®—ï¼‰' : 'ï¼Œç”¨æˆ·ID: ' + userId}</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('sm2-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">é”™è¯¯ï¼š</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        // å·¥å…·å‡½æ•°
        function derivePublicKey(compressed) {
            try {
                const privateKey = document.getElementById('tool-private-key').value.trim();
                
                if (!privateKey) {
                    alert('è¯·è¾“å…¥ç§é’¥');
                    return;
                }
                
                const publicKey = window.smkitHelpers.getPublicKeyFromPrivateKey(privateKey, compressed);
                const format = compressed ? 'å‹ç¼©æ ¼å¼' : 'éå‹ç¼©æ ¼å¼';
                const prefix = publicKey.substring(0, 2);
                
                document.getElementById('derive-result').innerHTML = `
                    <div class="result">
                        <h3>ç”Ÿæˆçš„å…¬é’¥ï¼ˆ${format}ï¼‰ï¼š</h3>
                        <pre style="word-break: break-all;">${publicKey}</pre>
                        <p style="margin-top: 10px; color: #666;">å‰ç¼€: ${prefix}</p>
                        <p style="color: #666;">é•¿åº¦: ${publicKey.length} å­—ç¬¦ (${publicKey.length / 2} å­—èŠ‚)</p>
                        <p style="color: #4CAF50;">âœ“ æˆåŠŸä»ç§é’¥å¯¼å‡ºå…¬é’¥</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('derive-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">é”™è¯¯ï¼š</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function convertPublicKey(type) {
            try {
                const publicKey = document.getElementById('tool-public-key').value.trim();
                
                if (!publicKey) {
                    alert('è¯·è¾“å…¥å…¬é’¥');
                    return;
                }
                
                let result, format;
                
                if (type === 'compress') {
                    result = window.smkitHelpers.compressPublicKey(publicKey);
                    format = 'å‹ç¼©æ ¼å¼';
                } else {
                    result = window.smkitHelpers.decompressPublicKey(publicKey);
                    format = 'éå‹ç¼©æ ¼å¼';
                }
                
                const prefix = result.substring(0, 2);
                
                document.getElementById('convert-result').innerHTML = `
                    <div class="result">
                        <h3>è½¬æ¢ç»“æœï¼ˆ${format}ï¼‰ï¼š</h3>
                        <pre style="word-break: break-all;">${result}</pre>
                        <p style="margin-top: 10px; color: #666;">å‰ç¼€: ${prefix}</p>
                        <p style="color: #666;">é•¿åº¦: ${result.length} å­—ç¬¦ (${result.length / 2} å­—èŠ‚)</p>
                        <p style="color: #4CAF50;">âœ“ è½¬æ¢æˆåŠŸ</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('convert-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">é”™è¯¯ï¼š</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function convertSignature(type) {
            try {
                const signature = document.getElementById('tool-signature').value.trim();
                
                if (!signature) {
                    alert('è¯·è¾“å…¥ç­¾å');
                    return;
                }
                
                let resultHtml;
                
                if (type === 'raw-to-der') {
                    const der = window.smkitHelpers.rawToDer(signature);
                    const derHex = window.smkitHelpers.bytesToHex(der);
                    resultHtml = `
                        <div class="result">
                            <h3>DER ç¼–ç ç­¾åï¼š</h3>
                            <pre style="word-break: break-all;">${derHex}</pre>
                            <p style="margin-top: 10px; color: #666;">é•¿åº¦: ${derHex.length} å­—ç¬¦ (${derHex.length / 2} å­—èŠ‚)</p>
                            <p style="color: #4CAF50;">âœ“ Raw â†’ DER è½¬æ¢æˆåŠŸ</p>
                        </div>
                    `;
                } else if (type === 'der-to-raw') {
                    // å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸º Uint8Array
                    const derBytes = new Uint8Array(signature.length / 2);
                    for (let i = 0; i < derBytes.length; i++) {
                        derBytes[i] = parseInt(signature.substring(i * 2, i * 2 + 2), 16);
                    }
                    const raw = window.smkitHelpers.derToRaw(derBytes);
                    resultHtml = `
                        <div class="result">
                            <h3>Raw æ ¼å¼ç­¾åï¼š</h3>
                            <pre style="word-break: break-all;">${raw}</pre>
                            <p style="margin-top: 10px; color: #666;">é•¿åº¦: ${raw.length} å­—ç¬¦ (${raw.length / 2} å­—èŠ‚)</p>
                            <p style="color: #4CAF50;">âœ“ DER â†’ Raw è½¬æ¢æˆåŠŸ</p>
                        </div>
                    `;
                } else if (type === 'to-xml') {
                    // è‡ªåŠ¨æ£€æµ‹æ ¼å¼
                    const isDer = signature.startsWith('30');
                    const xml = window.smkitHelpers.signatureToXml(signature, isDer);
                    resultHtml = `
                        <div class="result">
                            <h3>XML æ ¼å¼ï¼š</h3>
                            <pre style="white-space: pre-wrap; word-break: break-all;">${xml}</pre>
                            <p style="margin-top: 10px; color: #4CAF50;">âœ“ è½¬æ¢ä¸º XML æˆåŠŸ</p>
                        </div>
                    `;
                }
                
                document.getElementById('signature-result').innerHTML = resultHtml;
            } catch (error) {
                document.getElementById('signature-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">é”™è¯¯ï¼š</h3>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }
        
        function testRandomGenerator() {
            try {
                // ç”Ÿæˆå¤šä¸ªå¯†é’¥å¯¹æ¥æµ‹è¯•éšæœºæ•°ç”Ÿæˆå™¨
                const keyPairs = [];
                const startTime = Date.now();
                
                for (let i = 0; i < 5; i++) {
                    keyPairs.push(window.smkitHelpers.generateKeyPair());
                }
                
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                // æ£€æŸ¥ç”Ÿæˆçš„å¯†é’¥æ˜¯å¦å”¯ä¸€
                const uniqueKeys = new Set(keyPairs.map(kp => kp.privateKey));
                const allUnique = uniqueKeys.size === keyPairs.length;
                
                let resultHtml = `
                    <div class="result">
                        <h3>éšæœºæ•°ç”Ÿæˆå™¨æµ‹è¯•ç»“æœï¼š</h3>
                        <p style="margin-top: 10px;">âœ“ ç”Ÿæˆäº† ${keyPairs.length} ä¸ªå¯†é’¥å¯¹</p>
                        <p>âœ“ è€—æ—¶: ${duration} ms (å¹³å‡ ${(duration / keyPairs.length).toFixed(2)} ms/ä¸ª)</p>
                        <p>âœ“ å”¯ä¸€æ€§: ${allUnique ? 'é€šè¿‡' : 'å¤±è´¥'}</p>
                        <p style="margin-top: 15px; font-weight: bold;">ç”Ÿæˆçš„å¯†é’¥å¯¹ï¼š</p>
                `;
                
                keyPairs.forEach((kp, i) => {
                    resultHtml += `
                        <div style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 4px;">
                            <p style="font-weight: bold;">å¯†é’¥å¯¹ ${i + 1}:</p>
                            <p style="font-size: 12px; word-break: break-all;">ç§é’¥: ${kp.privateKey}</p>
                            <p style="font-size: 12px; word-break: break-all;">å…¬é’¥: ${kp.publicKey.substring(0, 66)}...</p>
                        </div>
                    `;
                });
                
                resultHtml += `
                        <p style="margin-top: 15px; color: #4CAF50;">âœ“ éšæœºæ•°ç”Ÿæˆå™¨å·¥ä½œæ­£å¸¸</p>
                    </div>
                `;
                
                document.getElementById('random-result').innerHTML = resultHtml;
            } catch (error) {
                document.getElementById('random-result').innerHTML = `
                    <div class="result" style="border-left-color: #f44336;">
                        <h3 style="color: #f44336;">é”™è¯¯ï¼š</h3>
                        <pre>${error.message}</pre>
                        <p style="margin-top: 10px; color: #f44336;">éšæœºæ•°ç”Ÿæˆå™¨å¯èƒ½ä¸å¯ç”¨</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
