# SMKit 演示和调试工具

这是 SMKit 库的交互式演示页面，提供了完整的功能测试和调试工具。

## 功能特性

### 1. SM3 哈希算法
- 计算任意文本的 SM3 哈希值
- 显示输入和输出的详细信息
- 实时交互式测试

### 2. SM4 加解密 ✨ 新增功能
- 支持多种加密模式：ECB、CBC、CTR、CFB、OFB
- 支持 PKCS7 和 None 填充模式
- 灵活的数据格式选项：
  - 密钥格式：十六进制或文本
  - IV 格式：十六进制或文本
  - 输出格式：十六进制或 Base64
- 完整的配置界面，类似专业加密工具
- 加密/解密测试

### 3. SM2 签名验签 ✨ 新增功能
- 生成密钥对（支持压缩和非压缩格式）
- **自动显示压缩和非压缩公钥**：生成密钥后同时展示两种格式
- 数字签名生成
- 签名验证
- SM2 加密/解密
- 支持跳过 Z 值计算选项（用于测试）

### 4. 调试工具 🔧

#### 私钥生成公钥
- 从私钥导出公钥
- 支持生成压缩格式和非压缩格式公钥
- 显示公钥格式信息（前缀、长度等）

#### 公钥格式转换
- **压缩公钥**：将非压缩公钥（130字符）转换为压缩格式（66字符）
  - 前缀 04 → 02/03
  - 节省约 49% 的存储空间
- **解压公钥**：将压缩公钥转换回非压缩格式
  - 前缀 02/03 → 04
  - 恢复完整的 x, y 坐标

#### 签名格式转换
- **Raw → DER**：将原始签名格式转换为 DER 编码
  - 输入：r || s（128 字符）
  - 输出：ASN.1 DER 编码（长度可变）
- **DER → Raw**：将 DER 编码转换为原始格式
  - 输入：DER 编码签名
  - 输出：r || s（128 字符）
- **转换为 XML**：将签名转换为 XML 格式以便查看
  - 显示 r 和 s 的值
  - 显示完整的 ASN.1 结构

#### 随机数生成测试
- 测试随机数生成器的可用性
- 生成多个密钥对验证唯一性
- 显示性能指标（生成速度）
- 检测随机数源（Web Crypto API、Node.js Crypto 或回退方案）

## 使用方法

### 本地运行

1. 构建项目：
```bash
npm run build
```

2. 启动本地服务器：
```bash
npm run demo
```

3. 在浏览器中打开 `http://localhost:3000/demo/`

### 功能示例

#### 示例 1：生成并测试 SM2 密钥对
1. 点击"生成密钥对（非压缩）"按钮
2. 查看生成的公钥和私钥
3. 输入要签名的消息
4. 点击"签名"按钮生成签名
5. 点击"验证签名"按钮验证签名

#### 示例 2：公钥格式转换
1. 切换到"调试工具"标签页
2. 在"公钥格式转换"部分粘贴公钥
3. 点击"压缩公钥"或"解压公钥"按钮
4. 查看转换结果和格式信息

#### 示例 3：签名格式转换
1. 在"签名格式转换"部分粘贴签名
2. 选择转换方式：
   - Raw → DER：适用于需要标准格式的场景
   - DER → Raw：适用于需要紧凑格式的场景
   - 转换为 XML：用于调试和可视化
3. 查看转换结果

## 技术特点

### 性能优化
- 使用 @noble/curves 进行高效的椭圆曲线运算
- 优化的 SM3 哈希算法实现
- 减少内存分配和数据复制
- 位运算优化

### 跨平台支持
- 浏览器环境
- Node.js 环境
- 微信小程序（需要适配）

### 随机数生成回退机制
1. **优先**: Web Crypto API（最安全）
2. **次选**: Node.js Crypto Module
3. **回退**: 时间戳 + Math.random()（仅用于测试）

### 代码质量
- TypeScript 完整类型支持
- 全面的错误处理
- 详细的代码注释
- 109 个单元测试，100% 通过

## 标准符合性

本实现遵循以下标准：
- GM/T 0003-2012: SM2 椭圆曲线公钥密码算法
- GM/T 0004-2012: SM3 密码杂凑算法
- GM/T 0002-2012: SM4 分组密码算法
- GM/T 0009-2012: SM2 密码算法使用规范
- GB/T 33560-2017: 信息安全技术 密码应用标识规范
- ITU-T X.690: ASN.1 编码规则

## 常见问题

### Q: 为什么要跳过 Z 值计算？
A: Z 值计算是 SM2 标准的一部分，用于将签名与用户身份绑定。跳过 Z 值计算：
- 可以提高性能（减少一次 SM3 计算）
- 可能用于与不支持 Z 值的系统互操作
- **不推荐在生产环境使用**，因为会降低安全性

### Q: 压缩公钥和非压缩公钥有什么区别？
A: 
- **非压缩格式**（65 字节）：04 || x || y
  - 包含完整的 x 和 y 坐标
  - 无需额外计算即可使用
- **压缩格式**（33 字节）：02/03 || x
  - 只包含 x 坐标和 y 的奇偶性
  - 需要通过椭圆曲线方程恢复 y 坐标
  - 节省约 49% 的存储空间

### Q: Raw 格式和 DER 格式签名有什么区别？
A:
- **Raw 格式**：r || s（固定 64 字节）
  - 更紧凑，适合存储
  - 国密标准常用
- **DER 格式**：ASN.1 编码（长度可变）
  - 更标准，适合互操作
  - 国际标准（如 X.509）使用

### Q: 为什么解析某些证书时看到 OID 1.2.840.10045.2.1 而不是 1.2.156.10197.1.301？
A: 这是 OpenSSL 版本差异导致的历史遗留问题：
- **OpenSSL 1.x**：SM2 公钥被错误地标识为标准 EC 公钥（OID: 1.2.840.10045.2.1）
- **OpenSSL 3.x**：SM2 公钥使用正确的国密标准 OID（1.2.156.10197.1.301）
- 如果您的证书是由 OpenSSL 1.x 生成的，会看到 1.2.840.10045.2.1
- **建议**：使用 OpenSSL 3.x 以确保符合 GB/T 33560-2017 标准
- 本库遵循国密标准，使用正确的 OID 1.2.156.10197.1.301

## 安全提示

⚠️ **重要**：
1. 不要在生产环境中使用演示页面生成的密钥
2. 私钥必须安全存储，不要泄露
3. 在不支持 Web Crypto API 的环境中，随机数质量可能不足
4. 跳过 Z 值计算会降低签名的安全性

## 技术栈

- 纯 HTML/CSS/JavaScript
- TypeScript 编译
- 现代浏览器兼容
- 响应式设计

## 开发和贡献

欢迎提交问题和贡献代码！

- GitHub: https://github.com/linyuliu/smkit
- NPM: https://www.npmjs.com/package/smkit

## 许可证

Apache-2.0
