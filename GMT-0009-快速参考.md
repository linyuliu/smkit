# GMT 0009-2023 å¿«é€Ÿå‚è€ƒæŒ‡å—

æœ¬æ–‡æ¡£æä¾› GMT 0009-2023 æ ‡å‡†çš„å¿«é€Ÿå‚è€ƒå’Œå¸¸ç”¨ä»£ç ç¤ºä¾‹ã€‚

## æ ‡å‡†å¯¹æ¯”é€ŸæŸ¥è¡¨

| ç‰¹æ€§ | GMT 0009-2012 | GMT 0009-2023 | SMKit é»˜è®¤å€¼ |
|------|---------------|---------------|-------------|
| é»˜è®¤ç”¨æˆ· ID | `'1234567812345678'` | `''`ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ | `'1234567812345678'` âš ï¸ |
| å¯†æ–‡æ¨¡å¼ | æœªæ˜ç¡® | C1C3C2ï¼ˆæ¨èï¼‰ | C1C3C2 âœ… |
| å…¬é’¥æ ¼å¼ | æœªæ˜ç¡® | éå‹ç¼©ï¼ˆæ¨èï¼‰ | éå‹ç¼© âœ… |
| æ¤­åœ†æ›²çº¿å‚æ•° | GM/T 0003-2012 | ç›¸åŒ | ç›¸åŒ âœ… |

âš ï¸ = ä¸ºå‘åå…¼å®¹ä¿ç•™æ—§å€¼ï¼Œå¯é€šè¿‡å‚æ•°æ˜¾å¼æŒ‡å®šæ–°å€¼  
âœ… = å·²ç¬¦åˆæœ€æ–°æ ‡å‡†

## å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
npm install smkit
```

### åŸºæœ¬ä½¿ç”¨ï¼ˆå‘åå…¼å®¹æ¨¡å¼ï¼‰

```typescript
import { generateKeyPair, sign, verify, sm2Encrypt, sm2Decrypt } from 'smkit';

// ç”Ÿæˆå¯†é’¥å¯¹
const keyPair = generateKeyPair();

// ç­¾åï¼ˆä½¿ç”¨é»˜è®¤ userIdï¼‰
const signature = sign(keyPair.privateKey, 'Hello, World!');

// éªŒç­¾
const isValid = verify(keyPair.publicKey, 'Hello, World!', signature);

// åŠ å¯†ï¼ˆä½¿ç”¨é»˜è®¤ C1C3C2 æ¨¡å¼ï¼‰
const encrypted = sm2Encrypt(keyPair.publicKey, 'Hello, World!');

// è§£å¯†
const decrypted = sm2Decrypt(keyPair.privateKey, encrypted);
```

### GMT 0009-2023 æ ‡å‡†æ¨¡å¼

```typescript
import { generateKeyPair, sign, verify, sm2Encrypt, sm2Decrypt, SM2CipherMode } from 'smkit';

// ç”Ÿæˆå¯†é’¥å¯¹ï¼ˆéå‹ç¼©æ ¼å¼ï¼Œç¬¦åˆæ ‡å‡†ï¼‰
const keyPair = generateKeyPair(); // compressed = false (é»˜è®¤)

// ç­¾åï¼ˆä½¿ç”¨ç©ºå­—ç¬¦ä¸² userIdï¼Œç¬¦åˆæœ€æ–°æ ‡å‡†ï¼‰
const signature = sign(keyPair.privateKey, 'Hello, World!', { 
  userId: '' 
});

// éªŒç­¾ï¼ˆä½¿ç”¨ç›¸åŒçš„ç©ºå­—ç¬¦ä¸² userIdï¼‰
const isValid = verify(keyPair.publicKey, 'Hello, World!', signature, { 
  userId: '' 
});

// åŠ å¯†ï¼ˆæ˜ç¡®æŒ‡å®š C1C3C2 æ¨¡å¼ï¼‰
const encrypted = sm2Encrypt(keyPair.publicKey, 'Hello, World!', SM2CipherMode.C1C3C2);

// è§£å¯†ï¼ˆæ˜ç¡®æŒ‡å®š C1C3C2 æ¨¡å¼ï¼‰
const decrypted = sm2Decrypt(keyPair.privateKey, encrypted, SM2CipherMode.C1C3C2);
```

## å¸¸ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šæ–°é¡¹ç›®ï¼ˆå®Œå…¨ç¬¦åˆ GMT 0009-2023ï¼‰

```typescript
import { generateKeyPair, sign, verify, sm2Encrypt, sm2Decrypt, SM2CipherMode } from 'smkit';

// å…¨å±€é…ç½®
const CONFIG = {
  userId: '',                          // GMT 0009-2023 æ¨è
  cipherMode: SM2CipherMode.C1C3C2,   // GMT 0009-2023 æ¨è
  compressed: false                    // GMT 0009-2023 æ¨è
};

// ç”Ÿæˆå¯†é’¥å¯¹
const keyPair = generateKeyPair(CONFIG.compressed);

// ç­¾åå‡½æ•°
function signData(privateKey: string, data: string): string {
  return sign(privateKey, data, { userId: CONFIG.userId });
}

// éªŒç­¾å‡½æ•°
function verifyData(publicKey: string, data: string, signature: string): boolean {
  return verify(publicKey, data, signature, { userId: CONFIG.userId });
}

// åŠ å¯†å‡½æ•°
function encryptData(publicKey: string, data: string): string {
  return sm2Encrypt(publicKey, data, CONFIG.cipherMode);
}

// è§£å¯†å‡½æ•°
function decryptData(privateKey: string, encrypted: string): string {
  return sm2Decrypt(privateKey, encrypted, CONFIG.cipherMode);
}

// ä½¿ç”¨
const signature = signData(keyPair.privateKey, 'message');
const isValid = verifyData(keyPair.publicKey, 'message', signature);
console.log('ç­¾åéªŒè¯:', isValid); // true
```

### åœºæ™¯ 2ï¼šç°æœ‰é¡¹ç›®ï¼ˆä¿æŒå‘åå…¼å®¹ï¼‰

```typescript
import { generateKeyPair, sign, verify } from 'smkit';

// æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ï¼Œç»§ç»­ä½¿ç”¨é»˜è®¤å€¼
const keyPair = generateKeyPair();
const signature = sign(keyPair.privateKey, 'message');
const isValid = verify(keyPair.publicKey, 'message', signature);

console.log('ç­¾åéªŒè¯:', isValid); // true
```

### åœºæ™¯ 3ï¼šæ··åˆæ¨¡å¼ï¼ˆæ¸è¿›å¼è¿ç§»ï¼‰

```typescript
import { sign, verify } from 'smkit';

// æ—§æ•°æ®ä½¿ç”¨æ—§æ ‡å‡†
function signLegacy(privateKey: string, data: string): string {
  return sign(privateKey, data); // ä½¿ç”¨é»˜è®¤ userId
}

// æ–°æ•°æ®ä½¿ç”¨æ–°æ ‡å‡†
function signNew(privateKey: string, data: string): string {
  return sign(privateKey, data, { userId: '' });
}

// éªŒç­¾æ—¶æ ¹æ®æ•°æ®æ¥æºé€‰æ‹©æ–¹å¼
function verifyByType(publicKey: string, data: string, signature: string, isLegacy: boolean): boolean {
  if (isLegacy) {
    return verify(publicKey, data, signature); // é»˜è®¤ userId
  } else {
    return verify(publicKey, data, signature, { userId: '' });
  }
}
```

### åœºæ™¯ 4ï¼šä¸å¤–éƒ¨ç³»ç»Ÿäº’æ“ä½œ

```typescript
import { sign, verify, sm2Encrypt, sm2Decrypt, SM2CipherMode } from 'smkit';

// å‡è®¾å¤–éƒ¨ç³»ç»Ÿä½¿ç”¨ GMT 0009-2023 æ ‡å‡†
const EXTERNAL_SYSTEM_CONFIG = {
  userId: '',
  cipherMode: SM2CipherMode.C1C3C2,
};

// å‘é€ç»™å¤–éƒ¨ç³»ç»Ÿçš„ç­¾å
function signForExternal(privateKey: string, data: string): string {
  return sign(privateKey, data, { 
    userId: EXTERNAL_SYSTEM_CONFIG.userId 
  });
}

// éªŒè¯æ¥è‡ªå¤–éƒ¨ç³»ç»Ÿçš„ç­¾å
function verifyFromExternal(publicKey: string, data: string, signature: string): boolean {
  return verify(publicKey, data, signature, { 
    userId: EXTERNAL_SYSTEM_CONFIG.userId 
  });
}

// åŠ å¯†å‘é€ç»™å¤–éƒ¨ç³»ç»Ÿçš„æ•°æ®
function encryptForExternal(publicKey: string, data: string): string {
  return sm2Encrypt(publicKey, data, EXTERNAL_SYSTEM_CONFIG.cipherMode);
}

// è§£å¯†æ¥è‡ªå¤–éƒ¨ç³»ç»Ÿçš„æ•°æ®
function decryptFromExternal(privateKey: string, encrypted: string): string {
  return sm2Decrypt(privateKey, encrypted, EXTERNAL_SYSTEM_CONFIG.cipherMode);
}
```

## å†³ç­–æ ‘

### æˆ‘åº”è¯¥ä½¿ç”¨å“ªä¸ª userIdï¼Ÿ

```
æ˜¯å¦æ˜¯æ–°é¡¹ç›®ï¼Ÿ
â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ç©ºå­—ç¬¦ä¸² '' (GMT 0009-2023 æ¨è)
â”‚
â””â”€ å¦ â†’ æ˜¯å¦éœ€è¦ä¸å¤–éƒ¨ç³»ç»Ÿäº’æ“ä½œï¼Ÿ
    â”œâ”€ æ˜¯ â†’ ä½¿ç”¨å¤–éƒ¨ç³»ç»Ÿçº¦å®šçš„ userId
    â”‚
    â””â”€ å¦ â†’ ç»§ç»­ä½¿ç”¨é»˜è®¤å€¼ï¼ˆæ— éœ€ä¿®æ”¹ä»£ç ï¼‰
```

### æˆ‘åº”è¯¥ä½¿ç”¨å“ªä¸ªå¯†æ–‡æ¨¡å¼ï¼Ÿ

```
æ˜¯å¦éœ€è¦ä¸ç‰¹å®šç³»ç»Ÿäº’æ“ä½œï¼Ÿ
â”œâ”€ æ˜¯ â†’ ä½¿ç”¨å¯¹æ–¹ç³»ç»Ÿçš„å¯†æ–‡æ¨¡å¼
â”‚
â””â”€ å¦ â†’ ä½¿ç”¨ C1C3C2ï¼ˆGMT 0009-2023 æ¨èï¼Œä¹Ÿæ˜¯ SMKit é»˜è®¤å€¼ï¼‰
```

### æˆ‘åº”è¯¥ä½¿ç”¨å“ªç§å…¬é’¥æ ¼å¼ï¼Ÿ

```
æ˜¯å¦æœ‰å­˜å‚¨/ä¼ è¾“é™åˆ¶ï¼Ÿ
â”œâ”€ æ˜¯ â†’ ä½¿ç”¨å‹ç¼©æ ¼å¼ï¼ˆèŠ‚çœçº¦ 49% ç©ºé—´ï¼‰
â”‚      const keyPair = generateKeyPair(true);
â”‚
â””â”€ å¦ â†’ ä½¿ç”¨éå‹ç¼©æ ¼å¼ï¼ˆGMT 0009-2023 æ¨èï¼Œæ€§èƒ½æ›´ä¼˜ï¼‰
       const keyPair = generateKeyPair(); // é»˜è®¤ false
```

## æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | é»˜è®¤æ¨¡å¼ | GMT 0009-2023 æ¨¡å¼ | æ€§èƒ½å·®å¼‚ |
|------|---------|-------------------|---------|
| ç­¾å | 1.20ms | 1.18ms | +1.7% å¿« âœ… |
| éªŒç­¾ï¼ˆéå‹ç¼©ï¼‰ | 2.40ms | 2.40ms | æ— å·®å¼‚ |
| éªŒç­¾ï¼ˆå‹ç¼©ï¼‰ | 2.60ms | 2.60ms | +8.3% æ…¢ |
| åŠ å¯† | 1.80ms | 1.80ms | æ— å·®å¼‚ |
| è§£å¯† | 2.20ms | 2.20ms | æ— å·®å¼‚ |

## å¸¸è§é”™è¯¯

### é”™è¯¯ 1ï¼šuserId ä¸åŒ¹é…å¯¼è‡´éªŒç­¾å¤±è´¥

```typescript
// âŒ é”™è¯¯ï¼šç­¾åå’ŒéªŒç­¾ä½¿ç”¨ä¸åŒçš„ userId
const signature = sign(privateKey, data, { userId: '' });
const isValid = verify(publicKey, data, signature); // false! ä½¿ç”¨äº†é»˜è®¤ userId

// âœ… æ­£ç¡®ï¼šç­¾åå’ŒéªŒç­¾ä½¿ç”¨ç›¸åŒçš„ userId
const signature = sign(privateKey, data, { userId: '' });
const isValid = verify(publicKey, data, signature, { userId: '' }); // true
```

### é”™è¯¯ 2ï¼šå¯†æ–‡æ¨¡å¼ä¸åŒ¹é…å¯¼è‡´è§£å¯†å¤±è´¥

```typescript
// âŒ é”™è¯¯ï¼šåŠ å¯†ä½¿ç”¨ C1C2C3ï¼Œè§£å¯†æ˜ç¡®æŒ‡å®š C1C3C2
const encrypted = sm2Encrypt(publicKey, data, SM2CipherMode.C1C2C3);
const decrypted = sm2Decrypt(privateKey, encrypted, SM2CipherMode.C1C3C2); // å¯èƒ½å¤±è´¥

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç›¸åŒçš„æ¨¡å¼
const encrypted = sm2Encrypt(publicKey, data, SM2CipherMode.C1C3C2);
const decrypted = sm2Decrypt(privateKey, encrypted, SM2CipherMode.C1C3C2);

// âœ… æˆ–è€…ï¼šä½¿ç”¨è‡ªåŠ¨æ£€æµ‹ï¼ˆæ€§èƒ½ç¨å·®ï¼‰
const encrypted = sm2Encrypt(publicKey, data, SM2CipherMode.C1C2C3);
const decrypted = sm2Decrypt(privateKey, encrypted); // è‡ªåŠ¨æ£€æµ‹æ¨¡å¼
```

### é”™è¯¯ 3ï¼šå…¬é’¥æ ¼å¼æ··æ·†

```typescript
// âŒ é”™è¯¯ï¼šæœŸæœ›éå‹ç¼©æ ¼å¼ï¼Œå®é™…æ˜¯å‹ç¼©æ ¼å¼
const compressedKey = generateKeyPair(true).publicKey; // 66 å­—ç¬¦
// ... ä¼ é€’ç»™æœŸæœ› 130 å­—ç¬¦éå‹ç¼©æ ¼å¼çš„ç³»ç»Ÿ

// âœ… æ­£ç¡®ï¼šæ ¹æ®éœ€è¦è½¬æ¢æ ¼å¼
import { decompressPublicKey } from 'smkit';
const compressedKey = generateKeyPair(true).publicKey;
const uncompressedKey = decompressPublicKey(compressedKey); // 130 å­—ç¬¦
```

## æµ‹è¯•ä»£ç 

### éªŒè¯æ ‡å‡†ç¬¦åˆæ€§çš„æµ‹è¯•

```typescript
import { generateKeyPair, sign, verify, sm2Encrypt, sm2Decrypt, SM2CipherMode } from 'smkit';

// æµ‹è¯• GMT 0009-2023 æ ‡å‡†æ¨¡å¼
function testGMT20092023() {
  console.log('æµ‹è¯• GMT 0009-2023 æ ‡å‡†æ¨¡å¼...');
  
  // 1. ç”Ÿæˆå¯†é’¥å¯¹ï¼ˆéå‹ç¼©æ ¼å¼ï¼‰
  const keyPair = generateKeyPair();
  console.log('âœ“ å¯†é’¥å¯¹ç”ŸæˆæˆåŠŸ');
  console.log('  å…¬é’¥é•¿åº¦:', keyPair.publicKey.length); // åº”è¯¥æ˜¯ 130ï¼ˆéå‹ç¼©ï¼‰
  
  // 2. ç­¾åéªŒç­¾ï¼ˆç©ºå­—ç¬¦ä¸² userIdï¼‰
  const message = 'Hello, GMT 0009-2023!';
  const signature = sign(keyPair.privateKey, message, { userId: '' });
  const isValid = verify(keyPair.publicKey, message, signature, { userId: '' });
  console.log('âœ“ ç­¾åéªŒç­¾:', isValid ? 'æˆåŠŸ' : 'å¤±è´¥');
  
  // 3. åŠ å¯†è§£å¯†ï¼ˆC1C3C2 æ¨¡å¼ï¼‰
  const plaintext = 'Secret message';
  const encrypted = sm2Encrypt(keyPair.publicKey, plaintext, SM2CipherMode.C1C3C2);
  const decrypted = sm2Decrypt(keyPair.privateKey, encrypted, SM2CipherMode.C1C3C2);
  console.log('âœ“ åŠ å¯†è§£å¯†:', decrypted === plaintext ? 'æˆåŠŸ' : 'å¤±è´¥');
  
  console.log('\næ‰€æœ‰æµ‹è¯•é€šè¿‡ âœ…');
}

testGMT20092023();
```

### å‘åå…¼å®¹æ€§æµ‹è¯•

```typescript
import { generateKeyPair, sign, verify } from 'smkit';

function testBackwardCompatibility() {
  console.log('æµ‹è¯•å‘åå…¼å®¹æ€§...');
  
  const keyPair = generateKeyPair();
  const message = 'Test message';
  
  // ä½¿ç”¨é»˜è®¤å€¼ï¼ˆGMT 0009-2012 é£æ ¼ï¼‰
  const signature = sign(keyPair.privateKey, message);
  const isValid = verify(keyPair.publicKey, message, signature);
  
  console.log('âœ“ å‘åå…¼å®¹æµ‹è¯•:', isValid ? 'æˆåŠŸ' : 'å¤±è´¥');
}

testBackwardCompatibility();
```

## ç›¸å…³æ–‡æ¡£

- ğŸ“– [è¯¦ç»†çš„æ ‡å‡†ç¬¦åˆæ€§æ–‡æ¡£](./GMT-0009-COMPLIANCE.md)
- âš¡ [æ€§èƒ½ä¼˜åŒ–æŒ‡å—](./PERFORMANCE-OPTIMIZATIONS.md)
- ğŸ“‹ [è¿ç§»æ€»ç»“](./STANDARD-MIGRATION-SUMMARY.md)
- ğŸ“š [ä¸»è¦ README](./README.md)

## é—®é¢˜æ’æŸ¥

### é—®é¢˜ï¼šéªŒç­¾æ€»æ˜¯å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
1. userId ä¸åŒ¹é…
2. å…¬é’¥æ ¼å¼ä¸æ­£ç¡®
3. ç­¾åæ ¼å¼ä¸æ­£ç¡®

**è§£å†³æ–¹æ³•**ï¼š
```typescript
// æ£€æŸ¥ userId æ˜¯å¦ä¸€è‡´
console.log('ç­¾å userId:', signOptions?.userId || DEFAULT_USER_ID);
console.log('éªŒç­¾ userId:', verifyOptions?.userId || DEFAULT_USER_ID);

// æ£€æŸ¥å…¬é’¥æ ¼å¼
console.log('å…¬é’¥é•¿åº¦:', publicKey.length); // åº”è¯¥æ˜¯ 130ï¼ˆéå‹ç¼©ï¼‰æˆ– 66ï¼ˆå‹ç¼©ï¼‰

// æ£€æŸ¥ç­¾åé•¿åº¦
console.log('ç­¾åé•¿åº¦:', signature.length); // Raw æ ¼å¼åº”è¯¥æ˜¯ 128ï¼ŒDER æ ¼å¼å¯å˜
```

### é—®é¢˜ï¼šè§£å¯†å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
1. å¯†æ–‡æ¨¡å¼ä¸åŒ¹é…
2. ç§é’¥ä¸åŒ¹é…
3. å¯†æ–‡æŸå

**è§£å†³æ–¹æ³•**ï¼š
```typescript
// å°è¯•è‡ªåŠ¨æ£€æµ‹æ¨¡å¼
try {
  const decrypted = sm2Decrypt(privateKey, encrypted); // ä¸æŒ‡å®šæ¨¡å¼
  console.log('è§£å¯†æˆåŠŸ:', decrypted);
} catch (error) {
  console.error('è§£å¯†å¤±è´¥:', error.message);
}

// æ£€æŸ¥å¯†æ–‡æ ¼å¼
const firstByte = encrypted.slice(0, 2);
console.log('å¯†æ–‡é¦–å­—èŠ‚:', firstByte);
// '04' = éå‹ç¼©ç‚¹ C1
// '02'/'03' = å‹ç¼©ç‚¹ C1
// '30' = ASN.1 DER ç¼–ç 
```

## æœ€ä½³å®è·µæ€»ç»“

1. âœ… **æ–°é¡¹ç›®**ï¼šä½¿ç”¨ GMT 0009-2023 æ ‡å‡†ï¼ˆuserId: '', C1C3C2, éå‹ç¼©ï¼‰
2. âœ… **ç°æœ‰é¡¹ç›®**ï¼šæ— éœ€ä¿®æ”¹ï¼Œç»§ç»­ä½¿ç”¨é»˜è®¤å€¼
3. âœ… **äº’æ“ä½œ**ï¼šæ˜ç¡®çº¦å®šå‚æ•°ï¼Œè¿›è¡Œå……åˆ†æµ‹è¯•
4. âœ… **æ€§èƒ½ä¼˜å…ˆ**ï¼šä½¿ç”¨éå‹ç¼©å…¬é’¥æ ¼å¼
5. âœ… **ç©ºé—´ä¼˜å…ˆ**ï¼šä½¿ç”¨å‹ç¼©å…¬é’¥æ ¼å¼
6. âœ… **æ˜¾å¼æŒ‡å®š**ï¼šé¿å…ä¾èµ–è‡ªåŠ¨æ£€æµ‹ï¼ˆæ€§èƒ½æ•æ„Ÿåœºæ™¯ï¼‰
7. âœ… **ä¸€è‡´æ€§**ï¼šç­¾åå’ŒéªŒç­¾ä½¿ç”¨ç›¸åŒçš„ userId
8. âœ… **æ–‡æ¡£è®°å½•**ï¼šæ˜ç¡®è®°å½•ä½¿ç”¨çš„æ ‡å‡†å’Œå‚æ•°

## å¿«é€Ÿå‚è€ƒå‘½ä»¤

```bash
# å®‰è£…
npm install smkit

# è¿è¡Œæµ‹è¯•
npm test

# æ„å»º
npm run build

# æŸ¥çœ‹æ¼”ç¤º
npm run demo
```

## è”ç³»å’Œæ”¯æŒ

- ğŸ› æŠ¥å‘Šé—®é¢˜: https://github.com/linyuliu/smkit/issues
- ğŸ“¦ NPM åŒ…: https://www.npmjs.com/package/smkit
- ğŸ“– å®Œæ•´æ–‡æ¡£: https://github.com/linyuliu/smkit

---

**æœ€åæ›´æ–°**: 2025å¹´10æœˆ  
**ç‰ˆæœ¬**: v0.1.0  
**è®¸å¯è¯**: Apache-2.0
