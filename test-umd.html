<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMKit UMD Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        h2 {
            color: #666;
            margin-top: 0;
        }
        pre {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .result {
            color: #0066cc;
            word-break: break-all;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <h1>SMKit UMD 模块测试</h1>
    <p>此页面测试 SMKit 的 UMD 模块格式，可以直接通过 &lt;script&gt; 标签使用。</p>

    <div class="test-section">
        <h2>测试 1: SM3 哈希</h2>
        <div id="test-sm3">正在测试...</div>
    </div>

    <div class="test-section">
        <h2>测试 2: SM4 加密解密</h2>
        <div id="test-sm4">正在测试...</div>
    </div>

    <div class="test-section">
        <h2>测试 3: SM2 密钥生成</h2>
        <div id="test-sm2">正在测试...</div>
    </div>

    <div class="test-section">
        <h2>测试 4: 工具函数</h2>
        <div id="test-utils">正在测试...</div>
    </div>

    <!-- 加载本地构建的 UMD 模块 -->
    <script src="./dist/smkit.umd.js"></script>
    
    <script>
        // 测试全局 SMKit 对象是否可用
        console.log('SMKit 全局对象:', SMKit);

        // 测试 1: SM3 哈希
        try {
            const testData = 'Hello, SMKit!';
            const hash = SMKit.digest(testData);
            document.getElementById('test-sm3').innerHTML = `
                <p class="success">✅ 测试通过</p>
                <p>输入: <code>${testData}</code></p>
                <p>SM3 哈希:</p>
                <pre class="result">${hash}</pre>
            `;
        } catch (error) {
            document.getElementById('test-sm3').innerHTML = `
                <p class="error">❌ 测试失败: ${error.message}</p>
            `;
        }

        // 测试 2: SM4 加密解密
        try {
            const key = '0123456789abcdeffedcba9876543210';
            const plaintext = '测试数据 Test Data';
            
            const encrypted = SMKit.sm4Encrypt(key, plaintext, { 
                mode: SMKit.CipherMode.ECB, 
                padding: SMKit.PaddingMode.PKCS7 
            });
            
            const decrypted = SMKit.sm4Decrypt(key, encrypted, { 
                mode: SMKit.CipherMode.ECB, 
                padding: SMKit.PaddingMode.PKCS7 
            });
            
            const success = decrypted === plaintext;
            
            document.getElementById('test-sm4').innerHTML = `
                <p class="${success ? 'success' : 'error'}">${success ? '✅' : '❌'} 测试${success ? '通过' : '失败'}</p>
                <p>密钥: <code>${key}</code></p>
                <p>明文: <code>${plaintext}</code></p>
                <p>密文: <code>${encrypted.substring(0, 64)}...</code></p>
                <p>解密: <code>${decrypted}</code></p>
            `;
        } catch (error) {
            document.getElementById('test-sm4').innerHTML = `
                <p class="error">❌ 测试失败: ${error.message}</p>
            `;
        }

        // 测试 3: SM2 密钥生成
        try {
            const keyPair = SMKit.generateKeyPair();
            const hasPrivateKey = keyPair.privateKey && keyPair.privateKey.length > 0;
            const hasPublicKey = keyPair.publicKey && keyPair.publicKey.length > 0;
            const success = hasPrivateKey && hasPublicKey;
            
            document.getElementById('test-sm2').innerHTML = `
                <p class="${success ? 'success' : 'error'}">${success ? '✅' : '❌'} 测试${success ? '通过' : '失败'}</p>
                <p>私钥 (前 32 字符): <code>${keyPair.privateKey.substring(0, 32)}...</code></p>
                <p>公钥 (前 32 字符): <code>${keyPair.publicKey.substring(0, 32)}...</code></p>
            `;
        } catch (error) {
            document.getElementById('test-sm2').innerHTML = `
                <p class="error">❌ 测试失败: ${error.message}</p>
            `;
        }

        // 测试 4: 工具函数
        try {
            const hexString = '48656c6c6f';
            const bytes = SMKit.hexToBytes(hexString);
            const backToHex = SMKit.bytesToHex(bytes);
            const text = SMKit.bytesToString(bytes);
            const success = backToHex === hexString;
            
            document.getElementById('test-utils').innerHTML = `
                <p class="${success ? 'success' : 'error'}">${success ? '✅' : '❌'} 测试${success ? '通过' : '失败'}</p>
                <p>十六进制: <code>${hexString}</code></p>
                <p>转换为字节数组: <code>[${Array.from(bytes).join(', ')}]</code></p>
                <p>转换回十六进制: <code>${backToHex}</code></p>
                <p>转换为字符串: <code>${text}</code></p>
            `;
        } catch (error) {
            document.getElementById('test-utils').innerHTML = `
                <p class="error">❌ 测试失败: ${error.message}</p>
            `;
        }
    </script>
</body>
</html>
